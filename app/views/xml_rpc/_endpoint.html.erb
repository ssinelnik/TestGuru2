<div class="xml-rpc-container">
  <h1>XML-RPC API Testing Interface</h1>

  <!-- Форма для ручного тестирования -->
  <%= form_with url: xmlrpc_path, method: :post, data: { type: :xml }, html: { 'data-type' => 'xml' } do |f| %>

    <div class="form-group">
      <%= f.label :method_name, "Method Name" %>
      <%= f.select :method_name,
          options_for_select(['test.add', 'user.get'], selected: 'test.add'),
          {}, class: 'form-control', id: 'method-selector' %>
    </div>

    <!-- Поля параметров -->
    <div id="params-container">
      <div class="param-group" data-method="test.add">
        <%= number_field_tag :param1, 0, class: 'form-control' %>
        <%= number_field_tag :param2, 0, class: 'form-control' %>
      </div>

      <div class="param-group" data-method="user.get" style="display:none;">
        <%= number_field_tag :user_id, 1, class: 'form-control' %>
      </div>
    </div>

    <%= f.submit "Send Request", class: 'btn btn-primary mt-3' %>
  <% end %>

  <!-- Блок вывода результатов -->
  <div class="mt-4">
    <% if @error %>
      <div class="alert alert-danger">
        <%= @error %>
      </div>
    <% end %>

    <% if @request_data %>
      <h3>Request:</h3>
      <pre class="bg-light p-3 rounded"><%= JSON.pretty_generate(@request_data) %></pre>
    <% end %>

    <% if @response_data %>
      <h3>Response:</h3>
      <pre class="bg-light p-3 rounded"><%= JSON.pretty_generate(@response_data) %></pre>
    <% end %>
  </div>
</div>

<script>
// JavaScript для динамического отображения полей
document.addEventListener('DOMContentLoaded', function() {
  const methodSelector = document.getElementById('method-selector');
  document.querySelectorAll('.param-group').forEach(group => {
    group.style.display = group.dataset.method === methodSelector.value ? 'block' : 'none';
  });

  methodSelector.addEventListener('change', function() {
    document.querySelectorAll('.param-group').forEach(group => {
      group.style.display = group.dataset.method === this.value ? 'block' : 'none';
    });
  });
});
</script>


<style>
.xml-rpc-container {
  max-width: 800px;
  margin: 2rem auto;
  padding: 20px;
}

.param-group {
  margin: 15px 0;
  padding: 15px;
  border: 1px solid #dee2e6;
  border-radius: 4px;
}

pre {
  white-space: pre-wrap;
  background: #f8f9fa;
  padding: 1rem;
  border-radius: 4px;
}
</style>
